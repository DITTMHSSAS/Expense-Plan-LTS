{
  "type": "calculated",
  "name": "Подбор_ЦеныСценарий3",
  "dataType": "string",
  "isDataTypeInferred": true,
  "expression": [
    "VAR tKRGD = IF( IFERROR( VALUE( 'Затраты'[Код СКМТР] ), 0  )=0,\"#$%#$\", 'Затраты'[Код СКМТР] )",
    "VAR tKNsi = IF( IFERROR( VALUE( 'Затраты'[Код НСИ] ), 0  )=0,\"#$%#$\", 'Затраты'[Код НСИ] )",
    "VAR tSld = 'Затраты'[СЛД]",
    "VAR tEd  = 'Затраты'[ЕдИзм]",
    "",
    "",
    "// Папка sЦеныЛТС",
    "VAR tTable0 =",
    "    FILTER(",
    "        '_ЦеныЛТС',",
    "            tKRGD ='_ЦеныЛТС'[СКМТР]",
    "            &&UPPER( tEd )=UPPER( '_ЦеныЛТС'[ЕдИзмНорм] )",
    "    )",
    "//sЦеныЛТС\\Цены только колодка (Медведков).xlsx по СКМТР",
    "VAR tTable00 =",
    "    FILTER(",
    "        '_ЦеныЛТС',",
    "            tKRGD ='_ЦеныЛТС'[СКМТР]",
    "            &&UPPER( tEd )=UPPER( '_ЦеныЛТС'[ЕдИзмНорм] )",
    "            &&'_ЦеныЛТС'[_ИмяФайла]=\"Цены только колодка (Медведков).xlsx\"",
    "    )",
    "",
    "//sЦеныЛТС\\Цены ЭРС3 (Посохин).xlsx по СКМТР",
    "VAR tTable01 =",
    "    FILTER(",
    "        '_ЦеныЛТС',",
    "            tKRGD ='_ЦеныЛТС'[СКМТР]",
    "            &&UPPER( tEd )=UPPER( '_ЦеныЛТС'[ЕдИзмНорм] )",
    "            &&'_ЦеныЛТС'[_ИмяФайла]=\"Цены ЭРС3 (Посохин).xlsx\"",
    "    )",
    "",
    "//sЦеныЛТС\\Цены ЭРС3 (Посохин).xlsx по КодНСИ",
    "VAR tTable011 =",
    "    FILTER(",
    "        '_ЦеныЛТС',",
    "            tKNsi ='_ЦеныЛТС'[Код НСИ]",
    "            &&UPPER( tEd )=UPPER( '_ЦеныЛТС'[ЕдИзмНорм] )",
    "            &&'_ЦеныЛТС'[_ИмяФайла]=\"Цены ЭРС3 (Посохин).xlsx\"",
    "    )",
    "",
    "//sЦеныЛТС\\Цены ТЭО_2014 (Колмыкова).xlsx по СКМТР",
    "VAR tTable02 =",
    "    FILTER(",
    "        '_ЦеныЛТС',",
    "            tKRGD ='_ЦеныЛТС'[СКМТР]",
    "            &&UPPER( tEd )=UPPER( '_ЦеныЛТС'[ЕдИзмНорм] )",
    "            &&'_ЦеныЛТС'[_ИмяФайла]=\"Цены ТЭО_2014 (Колмыкова).xlsx\"",
    "    )",
    "",
    "//sЦеныЛТС\\Цены ЭРС4 (Попова).xlsx по СКМТР",
    "VAR tTable03 =",
    "    FILTER(",
    "        '_ЦеныЛТС',",
    "            tKRGD ='_ЦеныЛТС'[СКМТР]",
    "            &&UPPER( tEd )=UPPER( '_ЦеныЛТС'[ЕдИзмНорм] )",
    "            &&'_ЦеныЛТС'[_ИмяФайла]=\"Цены ЭРС4 (Попова).xlsx\"",
    "",
    "    )",
    "//sЦеныЛТС\\Цены ЭРС4 (Попова).xlsx по КодНСИ",
    "VAR tTable031 =",
    "    FILTER(",
    "        '_ЦеныЛТС',",
    "            tKNsi ='_ЦеныЛТС'[Код НСИ]",
    "            &&UPPER( tEd )=UPPER( '_ЦеныЛТС'[ЕдИзмНорм] )",
    "            &&'_ЦеныЛТС'[_ИмяФайла]=\"Цены ЭРС4 (Попова).xlsx\"",
    "    )",
    "",
    "VAR tTable11 =",
    "    FILTER(",
    "        '_ЦеныАСУСГ',",
    "            '_ЦеныАСУСГ'[КлассификаторТиповЦен] = \"Цена закупки для контроля заказа ТМЦ\"",
    "            && tKNsi = '_ЦеныАСУСГ'[КодНСИ]",
    "            --&& tSld = '_ЦеныАСУСГ'[ТипЦенСЛД]",
    "            &&UPPER( tEd )=UPPER( '_ЦеныАСУСГ'[ЕдИзмНорм] )",
    "    )",
    "",
    "",
    "VAR tTable1 =",
    "    FILTER(",
    "        '_ЦеныАСУСГ',",
    "            '_ЦеныАСУСГ'[КлассификаторТиповЦен] = \"Цена закупки для контроля заказа ТМЦ\"",
    "            && tKRGD = '_ЦеныАСУСГ'[КодСКМТР]",
    "            --&& tSld = '_ЦеныАСУСГ'[ТипЦенСЛД]",
    "            &&UPPER( tEd )=UPPER( '_ЦеныАСУСГ'[ЕдИзмНорм] )",
    "    )",
    "",
    "VAR tTable2=    FILTER(",
    "        '_ЦеныЕРП',",
    "            '_ЦеныЕРП'[КлассификаторТиповЦен] = \"Прайс-лист 4pl\"",
    "            && tKRGD = '_ЦеныЕРП'[КодСКМТР]",
    "            --&& tSld = '_ЦеныЕРП'[ТипЦенСЛД]",
    "            &&UPPER( tEd )=UPPER( '_ЦеныЕРП'[ЕдИзмНорм] )",
    "    )",
    "",
    "VAR tTable21=    FILTER(",
    "        '_ЦеныЕРП',",
    "            '_ЦеныЕРП'[КлассификаторТиповЦен] = \"Прайс-лист 4pl\"",
    "            && tKNsi = '_ЦеныЕРП'[КодНСИ]",
    "            --&& tSld = '_ЦеныЕРП'[ТипЦенСЛД]",
    "            &&UPPER( tEd )=UPPER( '_ЦеныЕРП'[ЕдИзмНорм] )",
    "    )",
    "VAR tTable22=    FILTER(",
    "        '_ЦеныЕРП',",
    "            '_ЦеныЕРП'[КлассификаторТиповЦен] = \"Последняя цена закупки\"",
    "            && tKNsi = '_ЦеныЕРП'[КодНСИ]",
    "            --&& tSld = '_ЦеныЕРП'[ТипЦенСЛД]",
    "            &&UPPER( tEd )=UPPER( '_ЦеныЕРП'[ЕдИзмНорм] )",
    "    )",
    "",
    "VAR  tTable23 = FILTER(",
    "            '_ЦеныЕРП',",
    "            '_ЦеныЕРП'[КлассификаторТиповЦен] = \"Ожидаемый факт\"",
    "            && tKNsi = '_ЦеныЕРП'[КодНСИ]",
    "            --&& tSld = '_ЦеныЕРП'[ТипЦенСЛД]",
    "            && UPPER( tEd ) = UPPER( '_ЦеныЕРП'[ЕдИзмНорм] )",
    "    )",
    "VAR tTable3 =",
    "    FILTER(",
    "        '_ЦеныРЖД',",
    "            tKRGD ='_ЦеныРЖД'[СКМТР]",
    "            &&UPPER( tEd )=UPPER( '_ЦеныРЖД'[ЕдИзмНорм] )",
    "    )",
    "",
    "// ЦУНР_РЖД",
    "VAR tTable7 =",
    "    FILTER(",
    "        '_ЦеныЦУНР_РЖД',",
    "            tKRGD ='_ЦеныЦУНР_РЖД'[КодСКМТР]",
    "            &&UPPER( tEd )=UPPER( '_ЦеныЦУНР_РЖД'[ЕдИзмНорм] )",
    "    )",
    "",
    "// Цены_РЖД_Сводный",
    "VAR tTable8 =",
    "    FILTER(",
    "        '_ЦеныРЖД_Сводный',",
    "            tKRGD ='_ЦеныРЖД_Сводный'[КодСКМТР]",
    "            &&UPPER( tEd )=UPPER( '_ЦеныРЖД_Сводный'[ЕдИзмНорм] )",
    "",
    "    )",
    "",
    "VAR tRet0 = MAXX( tTable0, '_ЦеныЛТС'[Цена индексированная] )",
    "VAR tRet0_1 = MAXX( tTable0, '_ЦеныЛТС'[_ИмяФайла] )",
    "",
    "//sЦеныЛТС\\Цены только колодка (Медведков).xlsx",
    "VAR tRet00 = MAXX( tTable00, '_ЦеныЛТС'[Цена индексированная] )",
    "VAR tRet00_1 = MAXX( tTable00, '_ЦеныЛТС'[_ИмяФайла] )",
    "",
    "//sЦеныЛТС\\Цены ЭРС3 (Посохин).xlsx по код СКМТР",
    "VAR tRet01 = MAXX( tTable01, '_ЦеныЛТС'[Цена индексированная] )",
    "VAR tRet01_1 = MAXX( tTable01, '_ЦеныЛТС'[_ИмяФайла] )",
    "",
    "//sЦеныЛТС\\Цены ЭРС3 (Посохин).xlsx по код НСИ",
    "VAR tRet011 = MAXX( tTable011, '_ЦеныЛТС'[Цена индексированная] )",
    "VAR tRet011_1 = MAXX( tTable011, '_ЦеныЛТС'[_ИмяФайла] )",
    "",
    "//sЦеныЛТС\\Цены ТЭО_2014 (Колмыкова).xlsx",
    "VAR tRet02 = MAXX( tTable02, '_ЦеныЛТС'[Цена индексированная] )",
    "VAR tRet02_1 = MAXX( tTable02, '_ЦеныЛТС'[_ИмяФайла] )",
    "",
    "//sЦеныЛТС\\Цены ЭРС4 (Попова).xlsx по код СКМТР",
    "VAR tRet03 = MAXX( tTable03, '_ЦеныЛТС'[Цена индексированная] )",
    "VAR tRet03_1 = MAXX( tTable03, '_ЦеныЛТС'[_ИмяФайла] )",
    "",
    "//sЦеныЛТС\\Цены ЭРС4 (Попова).xlsx по код НСИ",
    "VAR tRet031 = MAXX( tTable031, '_ЦеныЛТС'[Цена индексированная] )",
    "VAR tRet031_1 = MAXX( tTable031, '_ЦеныЛТС'[_ИмяФайла] )",
    "",
    "VAR tRet1 = AVERAGEX( tTable1, '_ЦеныАСУСГ'[Цена индексированная] )",
    "VAR tRet11 = AVERAGEX( tTable11, '_ЦеныАСУСГ'[Цена индексированная] )",
    "",
    "VAR tRet2 = AVERAGEX( tTable2, '_ЦеныЕРП'[Цена] )",
    "VAR tRet21 = AVERAGEX( tTable21, '_ЦеныЕРП'[Цена] )",
    "VAR tRet22 = AVERAGEX( tTable22, '_ЦеныЕРП'[Цена] )",
    "VAR tRet23 = AVERAGEX( tTable23, '_ЦеныЕРП'[Цена] )",
    "",
    "VAR tRet3 = MAXX( TOPN( 1, tTable3, '_ЦеныРЖД'[Дата начала действия], 0, '_ЦеныРЖД'[Цена индексированная], 0 ), '_ЦеныРЖД'[Цена индексированная] )",
    "VAR tRet3_1 = MAXX( TOPN( 1, tTable3, '_ЦеныРЖД'[Дата начала действия], 0, '_ЦеныРЖД'[Цена индексированная], 0 ), '_ЦеныРЖД'[_ИмяФайла] )",
    "",
    "VAR tRet7=MAXX( tTable7, '_ЦеныЦУНР_РЖД'[ЦенаРЖДиндексированная] )",
    "",
    "VAR tRet8 = MAXX( TOPN( 1, tTable8, '_ЦеныРЖД_Сводный'[ЦенаРЖДиндексированная], 0, '_ЦеныРЖД_Сводный'[ЦенаРЖДиндексированная], 0 ), '_ЦеныРЖД_Сводный'[ЦенаРЖДиндексированная] )",
    "VAR tRet8_1 = MAXX( TOPN( 1, tTable8, '_ЦеныРЖД_Сводный'[ЦенаРЖДиндексированная], 0, '_ЦеныРЖД_Сводный'[ЦенаРЖДиндексированная], 0 ), '_ЦеныРЖД_Сводный'[Источник] )",
    "",
    "",
    "//VAR tPriceType1=\"Цена закупки для контроля заказа ТМЦ\"",
    "//VAR tPriceType2=\"Прайс-лист 4pl\"",
    "//VAR tPriceType22=\"Последняя цена закупки\"",
    "//VAR tPriceType23=\"Ожидаемый факт\"",
    "",
    "//0\tsЦеныЛТС\\Цены только колодка (Медведков).xlsx",
    "//1\tАСУСГ\\Цена закупки для контроля заказа ТМЦ",
    "//2\t1СЕРП\\Прайс-лист 4pl",
    "//3\tsЦеныРЖД\\Цены ТЭО_2014 (Колмыкова)",
    "//4\tsЦеныРЖД\\ЦеныРЖД_2014.xlsx",
    "//5\tsЦеныРЖД\\ЦеныРЖД_2021.xlsx",
    "//6\tsЦеныРЖД\\ЦеныРЖД_2022.xlsx",
    "//7\tВ разработке",
    "//8\tsЦеныЛТС\\Цены ЭРС3 (Посохин).xlsx",
    "//9 sЦеныЛТС\\Цены ТЭО_2014 (Колмыкова).xlsx",
    "//",
    "",
    "VAR tPriceType1=\"Цена закупки для контроля заказа ТМЦ\"",
    "VAR tPriceType2=\"Прайс-лист 4pl\"",
    "VAR tPriceType22=\"Последняя цена закупки\"",
    "VAR tPriceType23=\"Ожидаемый факт\"",
    "",
    "",
    "RETURN",
    "SWITCH(",
    "    TRUE(),",
    "    NOT ( ISBLANK( tRet8 ) ), \"0.(СводныйРЖД) максимальная по сводному по КодСКМТР, источник:\"&tRet8_1,    ",
    "    NOT ( ISBLANK( tRet00 ) ),  \"1.(1С ЛТС) \"&tRet00_1&\", максимальная по КодСКМТР\",",
    "    NOT ( ISBLANK( tRet1 ) ),  \"2.(АСУСГ)  \"&tPriceType1&\", средняя по КодСКМТР\",",
    "    NOT ( ISBLANK( tRet11 ) ), \"3.(АСУСГ)  \"&tPriceType1&\", средняя по КодНСИ\",",
    "    NOT ( ISBLANK( tRet2 ) ),  \"3.(1С ЕРП) \"&tPriceType2&\", средняя по КодСКМТР\",",
    "    NOT ( ISBLANK( tRet21 ) ), \"4.(1С ЕРП) \"&tPriceType2&\", средняя по КодНСИ\",",
    "    --NOT ( ISBLANK( tRet3 ) ),  \"5.(РЖДС)   \"&tRet31&\", средняя по КодСКМТР\",",
    "    --NOT ( ISBLANK( tRet7 ) ),  \"6.(ЦУНР РЖД) максимальная по КодСКМТР\",",
    "    NOT ( ISBLANK( tRet01 ) ),\"5.(1С ЛТС) \"&tRet01_1&\", максимальная по КодСКМТР\",",
    "    NOT ( ISBLANK( tRet011 ) ),\"5.(1С ЛТС) \"&tRet011_1&\", максимальная по КодНСИ\",",
    "    NOT ( ISBLANK( tRet02 ) ),\"6.(1С ЛТС) \"&tRet02_1&\", максимальная по КодСКМТР\",",
    "    NOT ( ISBLANK( tRet23 ) ),\"7.(1С ЕРП) \"&tPriceType23&\", средняя по КодСКМТР\",",
    "    \"!Цена не подобрана\"",
    ")"
  ],
  "displayFolder": "ПодборыЦен"
}