{
  "name": "__!сцЦУНР",
  "mode": "import",
  "source": {
    "type": "calculated",
    "expression": [
      "--    \"!СЦЕНАРИЙ\", \"ЭРС+, Годовой план 2023\",",
      "",
      "VAR  tPlans1 = SUMMARIZE( FILTER('Планы',",
      "            'Планы'[Год] = 12023",
      "            && 'Планы'[ТипПланирования] = \"Годовой план\"",
      "            && 'Планы'[ПринадлежностьМР]=\"Стороннее место ремонта\"",
      "            && SWITCH(TRUE(),",
      "                    'Планы'[КлассОбъектаРемонта] = \"Секция\" &&",
      "                    'Планы'[СценарииПланирования] IN { \"0,Предварительный (АПР)\", \"4. План ЦТ\" },",
      "                    TRUE(),",
      "                    'Планы'[КлассОбъектаРемонта] = \"Оборудование\" &&",
      "                    'Планы'[СценарииПланирования] IN { \"2. План УК ЛТ\" },",
      "                    TRUE()",
      "                )",
      "            ),",
      "    'Планы'[_Источник],",
      "    'Планы'[TIMESTAMP],",
      "",
      "    'Планы'[Год],",
      "    ",
      "    'Планы'[Сезонность],",
      "",
      "    'Планы'[СценарииПланирования],",
      "    'Планы'[ТипПланирования],",
      "",
      "    'Планы'[ВидРемонта],",
      "    'Планы'[КлассОбъектаРемонта],",
      "    'Планы'[ОбъектРемонта],",
      "    'Планы'[ОбъектРемонтаШаблон],",
      "    'Планы'[ОбъектРемонтаШаблонСерии],",
      "",
      "    'Планы'[СЛД],",
      "    'Планы'[МестоРемонта],",
      "    ",
      "    'Планы'[ДепоПриписки],",
      "    'Планы'[ДоговорСО],",
      "    'Планы'[ДрайверВыручки],",
      "    'Планы'[Модификация],",
      "    'Планы'[Статус],",
      "    'Планы'[ВидОперацииПланаПроизводства],",
      "    'Планы'[УправлениеПоЖД],",
      "    'Планы'[Филиал],",
      "    'Планы'[УстановленНа],",
      "    'Планы'[ПринадлежностьМР],",
      "    ",
      "    \"Период\",DATE( MAX( 'Планы'[Год] ), 1, 1 ),",
      "    \"КоличествоРемонтов\", SUM( 'Планы'[КоличествоРемонтов] )",
      ")",
      "",
      "VAR tPlan=SELECTCOLUMNS(tPlans1,",
      "    \"!СЦЕНАРИЙ\", \"ЦУНР СторонниеМР, Годовой план 2023\",",
      "    \"_план_Источник\",'Планы'[_Источник],",
      "    \"_план_TIMESTAMP\",'Планы'[TIMESTAMP],",
      "",
      "    \"_план_Год\",'Планы'[Год],",
      "    \"_план_Период\",[Период],",
      "    ",
      "    \"_план_Сезонность\",'Планы'[Сезонность],",
      "",
      "    \"_план_СценарииПланирования\",'Планы'[СценарииПланирования],",
      "    \"_план_ТипПланирования\",'Планы'[ТипПланирования],",
      "",
      "    \"_план_ВидРемонта\",'Планы'[ВидРемонта],",
      "    \"_план_КлассОбъектаРемонта\",'Планы'[КлассОбъектаРемонта],",
      "    \"_план_ОбъектРемонта\",'Планы'[ОбъектРемонта],",
      "    \"_план_ОбъектРемонтаШаблон\",'Планы'[ОбъектРемонтаШаблон],",
      "    \"_план_ОбъектРемонтаШаблонСерии\",'Планы'[ОбъектРемонтаШаблонСерии],",
      "",
      "    \"_план_СЛД\",'Планы'[СЛД],",
      "    \"_план_МестоРемонта\",'Планы'[МестоРемонта],",
      "    ",
      "    \"_план_ДепоПриписки\",'Планы'[ДепоПриписки],",
      "    \"_план_ДоговорСО\",'Планы'[ДоговорСО],",
      "    \"_план_ДрайверВыручки\",'Планы'[ДрайверВыручки],",
      "    \"_план_Модификация\",'Планы'[Модификация],",
      "    \"_план_Статус\",'Планы'[Статус],",
      "    \"_план_ВидОперацииПланаПроизводства\",'Планы'[ВидОперацииПланаПроизводства],",
      "    \"_план_УправлениеПоЖД\",'Планы'[УправлениеПоЖД],",
      "    \"_план_Филиал\",'Планы'[Филиал],",
      "    \"_план_УстановленНа\",'Планы'[УстановленНа],",
      "    \"_план_ПринадлежностьМР\",'Планы'[УстановленНа],",
      "",
      "    \"_план_КоличествоРемонтов\", [КоличествоРемонтов]   ",
      ")",
      "",
      "",
      "",
      "VAR tNorms=SELECTCOLUMNS(",
      "    FILTER('Нормативы','Нормативы'[ВидИсточника]=\"АСУСГпоМК\"",
      "        --&&'Нормативы'[ТипСпецификации] IN { \"Норма ЦУНР\", \"Норма ЦУНР +\", \"Эталонная (эксперимент)\", \"Эталонная\", \"Бюджетная\" }",
      "        &&'Нормативы'[ТипСпецификации] IN { \"Норма ЦУНР\", \"Норма ЦУНР +\", \"Эталонная\"}",
      "        &&'Нормативы'[ВидРесурса]=\"ТМЦ\"),",
      "    \"_Источник\",'Нормативы'[РесурснаяСпецификация],",
      "    \"ВидИсточника\",'Нормативы'[ВидИсточника],",
      "    \"_норм_ВидРесурса\",'Нормативы'[ВидРесурса],",
      "    \"_Код НСИ\",'Нормативы'[Код НСИ],    ",
      "    \"_Код СКМТР\",'Нормативы'[Код СКМТР],",
      "    \"_Номенклатура\",'Нормативы'[_Номенклатура],",
      "    \"_НоменклатураНСИ\",'Нормативы'[_НоменклатураНСИ],",
      "    \"ЕдИзм\",'Нормативы'[ЕдИзм],",
      "    \"_норм_Серия\",'Нормативы'[Серия],",
      "    \"_норм_ВидРемонта\",'Нормативы'[ВидРемонта],",
      "    ",
      "    \"_норм_Модификация\",'Нормативы'[Модификация],",
      "    \"_норм_Сверхцикл\",'Нормативы'[Сверхцикл],",
      "    \"_норм_Сезонность\",'Нормативы'[Сезонность],",
      "    \"_норм_СтатусРесурснойСпецификации\",'Нормативы'[СтатусРесурснойСпецификации],",
      "    \"_норм_СтатусНоменклатуры\",'Нормативы'[СтатусНоменклатуры],",
      "    \"_норм_КомплектМПИ\",'Нормативы'[КомплектМПИ],",
      "    \"_норм_ТарифныйРазряд\",'Нормативы'[ТарифныйРазряд],",
      "    \"_норм_ДоговорСО\",'Нормативы'[ДоговорСО],",
      "    \"_норм_ВидРабот\",'Нормативы'[ВидРабот],",
      "    \"_норм_СЛД\",'Нормативы'[СЛД],",
      "    \"_норм_МестоРемонта\",'Нормативы'[МестоРемонта],",
      "    ",
      "    \"_норм_КлассОбъектаРемонта\",'Нормативы'[КлассОбъектаРемонта],",
      "    \"_норм_ОбъектРемонтаШаблон\",'Нормативы'[ОбъектРемонтаШаблон],",
      "    \"_норм_ОбъектРемонтаШаблонСерии\",'Нормативы'[ОбъектРемонтаШаблонСерии],",
      "    ",
      "    \"_Количество\",'Нормативы'[_Количество],",
      "    \"_норм_КоличествоОбязательное\",'Нормативы'[_КоличествоОбязательное],",
      "    \"_КоличествоПроектЦиклЦУНР\",'Нормативы'[_КоличествоПроектЦиклЦУНР],",
      "    \"_КоличествоПроектЦиклЦУНР+\",'Нормативы'[_КоличествоПроектЦиклЦУНР+],",
      "    \"_норм_ТипСпецификации\", 'Нормативы'[ТипСпецификации],",
      "    \"СтатусЦУНРплюсЦУНР\", 'Нормативы'[СтатусЦУНРплюсЦУНР],",
      "    \"TIMESTAMP\",'Нормативы'[TIMESTAMP],",
      "    \"_норм_НачалоДействияРС\",'Нормативы'[НачалоДействияРС],",
      "    \"_норм_КонецДействияРС\",'Нормативы'[КонецДействияРС],",
      "    \"_норм_ПланируетсяОтдельно\",'Нормативы'[ПланируетсяОтдельно],",
      "    \"_норм_ПодзапросИсточник\",'Нормативы'[ПодзапросИсточник]",
      ")",
      "",
      "VAR  tRetTable = GENERATEALL(",
      "    tPlan,",
      "    (",
      "        VAR  tObj=IF([_план_КлассОбъектаРемонта]=\"Оборудование\",[_план_ОбъектРемонта],[_план_ОбъектРемонтаШаблон])",
      "",
      "        VAR  tPrzTSUNR = NOT ( ISBLANK( COUNTROWS( FILTER( tNorms,",
      "            [_норм_ОбъектРемонтаШаблон] = tObj",
      "            && [_норм_ВидРемонта] = [_план_ВидРемонта]",
      "            && [_норм_ТипСпецификации] = \"Норма ЦУНР\"",
      "            && OR(ISBLANK([_норм_МестоРемонта]),[_норм_МестоРемонта] = \"\" )",
      "            && OR( [_норм_Сезонность] = [_план_Сезонность], [_норм_Сезонность] = \"Всесезонная\" )",
      "            && [_норм_Модификация] = [_план_Модификация]",
      "        ) ) ) )   ",
      "        ",
      "        VAR  tPrzTSUNRplus = NOT ( ISBLANK( COUNTROWS( FILTER( tNorms,",
      "            [_норм_ОбъектРемонтаШаблон] = tObj",
      "            && [_норм_ВидРемонта] = [_план_ВидРемонта]",
      "            && [_норм_ТипСпецификации] = \"Норма ЦУНР +\"",
      "            && OR(ISBLANK([_норм_МестоРемонта]),[_норм_МестоРемонта] = \"\" )",
      "            && OR( [_норм_Сезонность] = [_план_Сезонность], [_норм_Сезонность] = \"Всесезонная\" )",
      "            && [_норм_Модификация] = [_план_Модификация]",
      "        ) ) ) ) ",
      "",
      "        VAR  tPrzERSplus = NOT ( ISBLANK( COUNTROWS( FILTER( tNorms,",
      "            [_норм_ОбъектРемонтаШаблон] = tObj",
      "            && [_норм_ВидРемонта] = [_план_ВидРемонта]",
      "            && [_норм_ТипСпецификации] = \"Эталонная (эксперимент)\"",
      "            && OR(ISBLANK([_норм_МестоРемонта]),[_норм_МестоРемонта] = \"\" )",
      "            && OR( [_норм_Сезонность] = [_план_Сезонность], [_норм_Сезонность] = \"Всесезонная\" )",
      "        ) ) ) )",
      "        VAR  tPrzERS = NOT ( ISBLANK( COUNTROWS( FILTER( tNorms,",
      "            [_норм_ОбъектРемонтаШаблон] = tObj",
      "            && [_норм_ВидРемонта] = [_план_ВидРемонта]",
      "            && [_норм_ТипСпецификации] = \"Эталонная\"",
      "            && OR(ISBLANK([_норм_МестоРемонта]),[_норм_МестоРемонта] = \"\" )",
      "            && OR( [_норм_Сезонность] = [_план_Сезонность], [_норм_Сезонность] = \"Всесезонная\" )",
      "        ) ) ) )",
      "        ",
      "        VAR  tPrzBudget20 = NOT ( ISBLANK( COUNTROWS( FILTER( tNorms,",
      "            [_норм_ОбъектРемонтаШаблон] = tObj",
      "            && [_норм_ВидРемонта] = [_план_ВидРемонта]",
      "            && [_норм_ТипСпецификации] = \"Бюджетная\"",
      "            && [_норм_НачалоДействияРС] = DATE( 2020, 1, 1 )",
      "            && [_норм_СЛД]=[_план_СЛД]",
      "            && [_норм_МестоРемонта]=[_план_МестоРемонта]",
      "            && [_норм_Модификация] = [_план_Модификация]",
      "        ) ) ) )",
      "        VAR  tPrzBudget21 = NOT ( ISBLANK( COUNTROWS( FILTER( tNorms,",
      "            [_норм_ОбъектРемонтаШаблон] = tObj",
      "            && [_норм_ВидРемонта] = [_план_ВидРемонта]",
      "            && [_норм_ТипСпецификации] = \"Бюджетная\"",
      "            && [_норм_НачалоДействияРС] = DATE( 2021, 1, 1 )",
      "            && [_норм_СЛД]=[_план_СЛД]",
      "            && [_норм_МестоРемонта]=[_план_МестоРемонта]",
      "            && [_норм_Модификация] = [_план_Модификация]",
      "        ) ) ) )",
      "        VAR  tPrzBudget22 = NOT ( ISBLANK( COUNTROWS( FILTER( tNorms,",
      "            [_норм_ОбъектРемонтаШаблон] = tObj",
      "            && [_норм_ВидРемонта] = [_план_ВидРемонта]",
      "            && [_норм_ТипСпецификации] = \"Бюджетная\"",
      "            && [_норм_НачалоДействияРС] = DATE( 2022, 1, 1 )",
      "            && [_норм_СЛД]=[_план_СЛД]",
      "            && [_норм_МестоРемонта]=[_план_МестоРемонта]",
      "            && [_норм_Модификация] = [_план_Модификация]",
      "        ) ) ) )",
      "        ",
      "        ",
      "        VAR tRetTable1=FILTER(tNorms,",
      "            [_норм_ОбъектРемонтаШаблон] = tObj",
      "            &&[ВидИсточника]=\"АСУСГпоМК\"",
      "            && [_норм_ВидРемонта] = [_план_ВидРемонта]",
      "            && SWITCH(TRUE(),",
      "                --tPrzTSUNRplus,[_норм_ТипСпецификации] = \"Норма ЦУНР +\",",
      "                tPrzTSUNR,    [_норм_ТипСпецификации] = \"Норма ЦУНР\",",
      "",
      "                --tPrzERSplus,  [_норм_ТипСпецификации] = \"Эталонная (эксперимент)\",",
      "                tPrzERS,      [_норм_ТипСпецификации] = \"Эталонная\",",
      "",
      "                tPrzBudget20, [_норм_ТипСпецификации] = \"Бюджетная\",",
      "                tPrzBudget21, [_норм_ТипСпецификации] = \"Бюджетная\",",
      "                tPrzBudget22, [_норм_ТипСпецификации] = \"Бюджетная\",",
      "                FALSE())",
      "--            && SWITCH(TRUE(),",
      "--                tPrzTSUNRplus,[ВидИсточника]=\"АСУСГпоМК\",",
      "--                tPrzERSplus,  [ВидИсточника]=\"АСУСГпоМК\",",
      "--                tPrzTSUNR,    [ВидИсточника]=\"АСУСГпоМК\",",
      "--                tPrzERS,      [ВидИсточника]=\"АСУСГпоМК\",             ",
      "--                tPrzBudget20, [ВидИсточника]=\"АСУСГпоМК\",",
      "--                tPrzBudget21, [ВидИсточника]=\"АСУСГпоМК\",",
      "--                tPrzBudget22, [ВидИсточника]=\"АСУСГпоМК\",",
      "--                FALSE())",
      "            && SWITCH(TRUE(),",
      "                --tPrzTSUNRplus,TRUE(),",
      "                tPrzTSUNR,    TRUE(),",
      "",
      "                --tPrzERSplus,  TRUE(),",
      "                tPrzERS,      TRUE(),",
      "                ",
      "                tPrzBudget20, [_норм_НачалоДействияРС] = DATE( 2020, 1, 1 ),",
      "                tPrzBudget21, [_норм_НачалоДействияРС] = DATE( 2021, 1, 1 ),",
      "                tPrzBudget22, [_норм_НачалоДействияРС] = DATE( 2022, 1, 1 ),",
      "                FALSE())",
      "            && SWITCH(TRUE(),",
      "                --tPrzTSUNRplus,TRUE(),",
      "                tPrzTSUNR,    TRUE(),",
      "",
      "                --tPrzERSplus,  TRUE(),",
      "                tPrzERS,      TRUE(),  ",
      "",
      "                tPrzBudget20, [_норм_СЛД]=[_план_СЛД],",
      "                tPrzBudget21, [_норм_СЛД]=[_план_СЛД],",
      "                tPrzBudget22, [_норм_СЛД]=[_план_СЛД],",
      "                FALSE())",
      "            && SWITCH(TRUE(),",
      "                --tPrzTSUNRplus,OR(ISBLANK([_норм_МестоРемонта]),[_норм_МестоРемонта] = \"\" ),",
      "                tPrzTSUNR,    OR(ISBLANK([_норм_МестоРемонта]),[_норм_МестоРемонта] = \"\" ),",
      "",
      "                --tPrzERSplus,  OR(ISBLANK([_норм_МестоРемонта]),[_норм_МестоРемонта] = \"\" ),",
      "                tPrzERS,      OR(ISBLANK([_норм_МестоРемонта]),[_норм_МестоРемонта] = \"\" ),",
      "                    ",
      "                tPrzBudget20, [_норм_МестоРемонта]=[_план_МестоРемонта],",
      "                tPrzBudget21, [_норм_МестоРемонта]=[_план_МестоРемонта],",
      "                tPrzBudget22, [_норм_МестоРемонта]=[_план_МестоРемонта],",
      "                FALSE())",
      "            && SWITCH(TRUE(),",
      "                --tPrzTSUNRplus,OR( [_норм_Сезонность] = [_план_Сезонность], [_норм_Сезонность] = \"Всесезонная\" ),",
      "                tPrzTSUNR,    OR( [_норм_Сезонность] = [_план_Сезонность], [_норм_Сезонность] = \"Всесезонная\" ),",
      "",
      "                --tPrzERSplus,  OR( [_норм_Сезонность] = [_план_Сезонность], [_норм_Сезонность] = \"Всесезонная\" ),                 ",
      "                tPrzERS,      OR( [_норм_Сезонность] = [_план_Сезонность], [_норм_Сезонность] = \"Всесезонная\" ),",
      "",
      "                tPrzBudget20, TRUE(),",
      "                tPrzBudget21, TRUE(),",
      "                tPrzBudget22, TRUE(),",
      "                FALSE())",
      "            && SWITCH(TRUE(),",
      "                --tPrzTSUNRplus,[_норм_Модификация] = [_план_Модификация],",
      "                tPrzTSUNR,    [_норм_Модификация] = [_план_Модификация],",
      "",
      "                --tPrzERSplus,  TRUE(),",
      "                tPrzERS,      TRUE(), ",
      "                ",
      "                tPrzBudget20, [_норм_Модификация] = [_план_Модификация],",
      "                tPrzBudget21, [_норм_Модификация] = [_план_Модификация],",
      "                tPrzBudget22, [_норм_Модификация] = [_план_Модификация],",
      "                FALSE())",
      "        )",
      "        RETURN",
      "        tRetTable1",
      "    )",
      ")",
      "RETURN",
      "tRetTable"
    ]
  }
}